# Phase 3 — Panel actions + probes (2025-11-12)

## Commands
- `git switch -c feat/diary-phase3-actions`
- `npm ci`
- `echo "VITE_FEATURE_DIARY=1" > .env.local`
- `npm run data:gen`
- `npm run data:check`
- `npm run build`

## Idempotence probe
`__diary_debug.runP3IdempotenceCycles({ cycles: 20 })`
```json
{
  "stable": true,
  "sources": ["diary-segments","diary-route-overlay","diary-alt-route","diary-sim-point"],
  "layers": ["diary-segments-line","diary-route-overlay-line","diary-alt-route-line","diary-sim-point-circle"],
  "duplicates": []
}
```

## Submit → repaint timing
`__diary_debug.getPerfSnapshot()`
```json
{
  "ms": 184,
  "at": "2025-11-12T19:40:12Z",
  "text": "184 ms (submit → repaint)"
}
```

## Segment update sample
Rated `route_B` (overall 4, tags `poor_lighting`). Segment `seg_001` changed as follows:
```json
// before
{"segment_id":"seg_001","decayed_mean":2.6,"n_eff":4,"delta_30d":0.10,"top_tags":[]}
// after
{"segment_id":"seg_001","decayed_mean":2.94,"n_eff":5,"delta_30d":0.34,"top_tags":[{"tag":"poor_lighting","p":1.00}]}
```
