# Diary UI Demo Investigation (20251116T170200Z)

## Commands
- npm install
- npm run data:gen && npm run data:check
- npm run build (vite warnings only about externalized modules)

## Finding
- Integrated Diary panel stayed in skeleton because `initDiaryMode` was firing before the MapLibre style finished loading, causing `mountSegmentsLayer` (addSource) to throw and abort the UI build. Fixed by deferring Diary init until the map `load` event inside `src/main.js`.

## Files touched
- src/main.js (Diary init waits for map load)
- diary-demo.html (new standalone entry)
- src/diary_demo_main.js (standalone Diary bootstrap)

## URLs
- Integrated: http://localhost:5173/?mode=diary
- Standalone: http://localhost:5173/diary-demo.html

## Source/layer snapshots
- Diary after 10 toggles: ["diary-segments","diary-route-overlay","diary-alt-route","diary-sim-point"] / ["diary-segments-line","diary-route-overlay-line","diary-alt-route-line","diary-sim-point-circle"]
- Crime baseline: [] / []

## Segment sample
Before CTA: {"segment_id":"seg_001","decayed_mean":2.80,"n_eff":4.4}
After CTA (Agree): {"segment_id":"seg_001","decayed_mean":2.80,"n_eff":4.7}
